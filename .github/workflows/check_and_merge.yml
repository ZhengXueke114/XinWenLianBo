name: Check Completeness And Auto Merge to Master  
  
on:  
  push:  
    branches: [ develop ]  
  
jobs:  
  create_pr:  
    runs-on: ubuntu-22.04 
    steps:  
    - uses: actions/checkout@v4 
    - name: Create Pull Request  
      uses: actions/github-script@v6 
      with:  
        github-token: ${{secrets.GITHUB_TOKEN}}  
        script: |  
          const result = await github.rest.pulls.create({  
            owner: context.repo.owner,  
            repo: context.repo.repo,  
            title: 'Auto Merge from Develop',  
            head: 'develop',  
            base: 'master'  
          })  
          core.setOutput('pull_request_number', result.data.number)
  check_commit:  
    runs-on: ubuntu-22.04  
    steps:  
    - uses: actions/checkout@v4
    - name: Set up Python 3.8  
      uses: actions/setup-python@v4
      with:  
        python-version: 3.8  
        cache: 'pip'
    - name: Install dependencies  
      run: pip install -r requirements.txt
    - name: Run Python script to check commit  
      id: python_run
      run: python3 check_completeness.py
    - name: Output Run Result
      run: echo ${{ steps.python_run.outputs.result }}
      env:  
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}  
    outputs:  
      should_merge: ${{ steps.python_run.outputs.result == 'success' }}

  merge_pr:  
    runs-on: ubuntu-22.04  
    needs: [check_commit]  
    if: needs.check_commit.outputs.should_merge == 'true'  
    steps:  
    - name: Merge Pull Request  
      uses: actions/github-script@v6 
      with:  
        github-token: ${{secrets.GITHUB_TOKEN}}  
        script: |  
          github.rest.pulls.merge({  
            owner: context.repo.owner,  
            repo: context.repo.repo,  
            pull_number: ${{needs.create_pr.outputs.pull_request_number}}  
          })
